global [ packetsize ]

to ul-power
	init-onboardleds
	redon
	wait 10
	redoff
end

to ul-init
	yellowon
	init-sd
	setpacketsize 16
	wait 10
	yellowoff
end

to ul-go
	greenon
	wait 10 
	greenoff
	loop 
	[
		blueon
		wait 10
		collect-data
		blueoff
		wait 100	
	]
end

to read-IR-sensor
	output readADC 0
end

to read-Optical-sensor
	output readADC 1
end

to collect-data
	blueon
	init-packet 10
	packet-word read-IR-sensor
	packet-word read-Optical-sensor
	add-checksum
	wait 10
	blueoff
end

to write-packet-sd
	setn 0
	repeat packetsize [
		print readb  ($1fc0 + n)
		setn n + 1	
	]
	SD-Log-Chunk $1fc0 packetsize
end
